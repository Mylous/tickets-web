<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
  // Configuraci√≥n de tu proyecto Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBo3UxLTkYOutD_uwUWm3jqneOhthXPPrw",
    authDomain: "ticketedel-web.firebaseapp.com",
    projectId: "ticketedel-web",
    storageBucket: "ticketedel-web.firebasestorage.app",
    messagingSenderId: "111851130873",
    appId: "1:111851130873:web:06c5a5e7a517184228b728"
  };

  // Inicializar Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Call Me Bro Tickets</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #ffe6f0, #ffd9e6);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  min-height: 100vh;
}

h1 {
  color: #ff4d6d;
  margin-bottom: 10px;
  text-shadow: 1px 1px 2px #fff;
}

img#mainImage {
  max-width: 300px;
  border-radius: 16px;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.ticket-info {
  background: white;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  text-align: center;
  margin-bottom: 20px;
}

.ticket-info p {
  font-size: 18px;
  margin: 5px 0;
  color: #ff4d6d;
  font-weight: bold;
}

button {
  background: #ff4d6d;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 12px;
  font-size: 16px;
  cursor: pointer;
  margin: 5px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

button:disabled {
  background: gray;
  cursor: not-allowed;
}

#timer {
  margin-top: 15px;
  font-size: 18px;
  font-weight: bold;
  color: #ff1a50;
}

.hearts {
  font-size: 24px;
  margin-top: 10px;
  color: #ff4d6d;
  animation: float 2s infinite alternate;
}

@keyframes float {
  0% { transform: translateY(0); }
  100% { transform: translateY(-10px); }
}
</style>
</head>
<body>
<h1>üéüÔ∏è Tickets for Call Me Bro</h1>
<img id="mainImage" src="ticket_to_bro_me.png" alt="Romantic Image">

<div class="ticket-info">
  <p>Available Tickets: <span id="ticketCount">0</span></p>
  <button id="useBtn">Use</button>
  <div id="timer"></div>
  <div class="hearts">‚ù§Ô∏èüíïüíñ</div>
</div>

<button id="addBtn" style="display:none;">‚ûï Add Ticket</button>

<script>
const useBtn = document.getElementById('useBtn');
const addBtn = document.getElementById('addBtn');
const ticketCountSpan = document.getElementById('ticketCount');
const timerDiv = document.getElementById('timer');

let tickets = 0;
let countdownEnd = null;
let countdownInterval = null;

// Funci√≥n para guardar tickets y countdown en Firestore
async function saveTickets() {
  await db.collection('tickets').doc('user1').set({ 
    count: tickets,
    countdownEnd: countdownEnd
  });
}

// Mostrar tickets y temporizador
function updateTicketDisplay() {
  ticketCountSpan.textContent = tickets;
}

// Funci√≥n countdown
function startCountdown() {
  if (countdownInterval) clearInterval(countdownInterval);
  if (!countdownEnd || countdownEnd <= Date.now()) {
    countdownEnd = null;
    useBtn.disabled = false;
    timerDiv.textContent = "";
    saveTickets();
    return;
  }

  useBtn.disabled = true;
  countdownInterval = setInterval(() => {
    let remaining = countdownEnd - Date.now();
    if(remaining <= 0){
      clearInterval(countdownInterval);
      countdownEnd = null;
      timerDiv.textContent = "‚úÖ Ticket expired!";
      useBtn.disabled = false;
      saveTickets();
    } else {
      let hours = Math.floor((remaining / (1000*60*60)) % 24);
      let minutes = Math.floor((remaining / (1000*60)) % 60);
      let seconds = Math.floor((remaining / 1000) % 60);
      timerDiv.textContent = `‚è≥ ${hours}h ${minutes}m ${seconds}s remaining`;
    }
  }, 1000);
}

// Sincronizaci√≥n en tiempo real con Firestore
db.collection('tickets').doc('user1').onSnapshot(doc => {
  if (doc.exists) {
    tickets = doc.data().count || 0;
    countdownEnd = doc.data().countdownEnd || null;
    updateTicketDisplay();
    startCountdown();
  }
});

// Bot√≥n usar ticket
useBtn.addEventListener('click', async () => {
  if(tickets > 0 && !countdownEnd){
    tickets--;
    countdownEnd = Date.now() + 24*60*60*1000; // 24h
    await saveTickets();
    updateTicketDisplay();
    startCountdown();
  }
});

// Secret add button
document.addEventListener('keydown', function(e){
  if(e.ctrlKey && e.shiftKey && e.key === 'A'){
    if(addBtn.style.display === 'none'){
      addBtn.style.display = 'inline-block';
      alert("Secret Add Button Activated!");
    } else {
      addBtn.style.display = 'none';
    }
  }
});

addBtn.addEventListener('click', async () => {
  tickets++;
  await saveTickets();
  updateTicketDisplay();
});
</script>
</body>
</html>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"></script>

<script>
  // Configuraci√≥n de tu proyecto Firebase
  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    projectId: "TU_PROJECT_ID",
    storageBucket: "TU_STORAGE_BUCKET",
    messagingSenderId: "TU_MESSAGING_SENDER_ID",
    appId: "TU_APP_ID"
  };

  // Inicializar Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Call Me Bro Tickets</title>
 <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #ffe6f0, #ffd9e6);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
    }

    h1 {
      color: #ff4d6d;
      margin-bottom: 10px;
      text-shadow: 1px 1px 2px #fff;
    }

    img#mainImage {
      max-width: 300px;
      border-radius: 16px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .ticket-info {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      text-align: center;
      margin-bottom: 20px;
    }

    .ticket-info p {
      font-size: 18px;
      margin: 5px 0;
      color: #ff4d6d;
      font-weight: bold;
    }

    button {
      background: #ff4d6d;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    button:disabled {
      background: gray;
      cursor: not-allowed;
    }

    #timer {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
      color: #ff1a50;
    }

    /* Romantic decoration */
    .hearts {
      font-size: 24px;
      margin-top: 10px;
      color: #ff4d6d;
      animation: float 2s infinite alternate;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      100% { transform: translateY(-10px); }
    }
  </style>
</head>
<body>
  <h1>üéüÔ∏è Tickets for Call Me Bro</h1>

  <!-- Image below title -->
  <img id="mainImage" src="ticket_to_bro_me.png" alt="Romantic Image">

  <div class="ticket-info">
    <p>Available Tickets: <span id="ticketCount">0</span></p>
    <button id="useBtn">Use</button>
    <div id="timer"></div>
    <div class="hearts">‚ù§Ô∏èüíïüíñ</div>
  </div>

  <!-- Secret Add Button -->
  <button id="addBtn" style="display:none;">‚ûï Add Ticket</button>

  <script>
    const useBtn = document.getElementById('useBtn');
    const addBtn = document.getElementById('addBtn');
    const ticketCountSpan = document.getElementById('ticketCount');
    const timerDiv = document.getElementById('timer');

    let tickets = 0;  // inicializamos en 0
let countdownEnd = parseInt(localStorage.getItem('countdownEnd')) || null;

// Funci√≥n para cargar tickets desde Firestore
async function loadTickets() {
  const doc = await db.collection('tickets').doc('user1').get();
  tickets = doc.exists ? doc.data().count : 0;
  ticketCountSpan.textContent = tickets;
}

// Funci√≥n para guardar tickets en Firestore
async function saveTickets() {
  await db.collection('tickets').doc('user1').set({ count: tickets });
}

// Mostrar tickets iniciales
loadTickets();

function updateTicketDisplay() {
  ticketCountSpan.textContent = tickets;
  saveTickets();  // ahora guarda en Firestore en lugar de localStorage
}

    // Use ticket
    useBtn.addEventListener('click', () => {
      if(tickets > 0 && !countdownEnd) {
        tickets--;
        updateTicketDisplay();
        countdownEnd = Date.now() + 24*60*60*1000; // 24h
        localStorage.setItem('countdownEnd', countdownEnd);
        startCountdown();
      }
    });

    // Countdown function
    function startCountdown() {
      if (!countdownEnd) return;
      useBtn.disabled = true;

      const interval = setInterval(() => {
        let remaining = countdownEnd - Date.now();
        if(remaining <= 0){
          clearInterval(interval);
          timerDiv.textContent = "‚úÖ Ticket expired!";
          countdownEnd = null;
          localStorage.removeItem('countdownEnd');
          useBtn.disabled = false;
        } else {
          let hours = Math.floor((remaining / (1000*60*60)) % 24);
          let minutes = Math.floor((remaining / (1000*60)) % 60);
          let seconds = Math.floor((remaining / 1000) % 60);
          timerDiv.textContent = `‚è≥ ${hours}h ${minutes}m ${seconds}s remaining`;
        }
      }, 1000);
    }

    // Resume countdown if exists
    if(countdownEnd && countdownEnd > Date.now()) startCountdown();

    // Secret add button
    document.addEventListener('keydown', function(e){
      if(e.ctrlKey && e.shiftKey && e.key === 'A'){
        if(addBtn.style.display === 'none'){
          addBtn.style.display = 'inline-block';
          alert("Secret Add Button Activated!");
        } else {
          addBtn.style.display = 'none';
        }
      }
    });

    // Add ticket (secret)
    addBtn.addEventListener('click', () => {
      tickets++;
      updateTicketDisplay();
    });
  </script>
</body>
</html>
